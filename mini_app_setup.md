# Настройка Telegram Mini App

## Что такое Telegram Mini App?

Telegram Mini App - это веб-приложение, которое работает прямо в Telegram с удобным интерфейсом. Пользователи могут открыть его через кнопку в боте или через меню.

## Преимущества Mini App

- **Удобный интерфейс** - современный веб-дизайн вместо текстовых команд
- **Быстрая работа** - все действия в одном окне
- **Адаптивность** - работает на всех устройствах
- **Интеграция с Telegram** - автоматическая аутентификация пользователей

## Настройка Mini App

### 1. Установка зависимостей

```bash
pip3 install flask gunicorn
```

### 2. Настройка переменных окружения

```bash
# Основные настройки (уже должны быть установлены)
export TELEGRAM_BOT_TOKEN="ваш_токен_от_BotFather"
export ADMIN_IDS="ваш_id"

# Новые настройки для Mini App
export FLASK_SECRET_KEY="ваш_секретный_ключ_для_flask"
export PORT="5000"  # Порт для веб-сервера (опционально)
```

### 3. Запуск Mini App

```bash
python3 run_mini_app.py
```

Mini App будет доступен по адресу: `http://localhost:5000`

### 4. Настройка бота для работы с Mini App

Вам нужно настроить webhook или добавить кнопку в бота для открытия Mini App.

## Функциональность Mini App

### Для всех пользователей:
- **Просмотр кранов** - список всех кранов с подробной информацией
- **Поиск по кранам** - быстрый доступ к информации о пиве
- **Адаптивный дизайн** - удобно на любом устройстве

### Для администраторов:
- **Добавление пива** - форма для добавления нового пива в кран
- **Редактирование** - изменение информации о существующем пиве
- **Удаление** - удаление пива из крана
- **Управление** - дополнительные административные функции

## Структура файлов Mini App

```
SqlLite-Beers/
├── mini_app.py              # Основной Flask сервер
├── run_mini_app.py          # Скрипт запуска
├── templates/
│   └── index.html          # HTML шаблон
├── static/
│   ├── css/
│   │   └── style.css       # Стили для веб-интерфейса
│   └── js/
│       └── app.js          # JavaScript логика
└── mini_app_setup.md       # Эта инструкция
```

## API Endpoints

Mini App предоставляет следующие API:

- `GET /api/taps` - получить список всех кранов
- `GET /api/tap/<id>` - получить информацию о кране
- `POST /api/tap` - добавить пиво в кран (админы)
- `PUT /api/tap/<id>` - обновить информацию о кране (админы)
- `DELETE /api/tap/<id>` - удалить пиво из крана (админы)

## Безопасность

- **Аутентификация через Telegram** - проверка подлинности пользователей
- **Права доступа** - разделение функций для админов и пользователей
- **Валидация данных** - проверка всех входящих данных

## Развертывание на сервере

### Для продакшена используйте Gunicorn:

```bash
# Установка Gunicorn
pip3 install gunicorn

# Запуск в продакшене
gunicorn -w 4 -b 0.0.0.0:5000 mini_app:app
```

### Настройка nginx (опционально):

```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## Интеграция с ботом

Чтобы бот мог открывать Mini App, добавьте в код бота:

```python
# В telegram_bot.py добавьте команду для открытия Mini App
@app.route('/webapp')
def webapp():
    return render_template('webapp.html')

# Или добавьте кнопку в бота
web_app_button = InlineKeyboardButton(
    "Открыть приложение",
    web_app=WebAppInfo(url="https://your-domain.com")
)
```

## Отладка

### Проверка работы Mini App:

1. Запустите Mini App: `python3 run_mini_app.py`
2. Откройте браузер: `http://localhost:5000`
3. Проверьте консоль браузера на ошибки JavaScript
4. Проверьте логи Flask в терминале

### Частые проблемы:

- **Ошибка 500** - проверьте переменные окружения
- **Не загружаются данные** - проверьте подключение к базе данных
- **Не работают права админа** - проверьте ADMIN_IDS

## Обновления

Mini App автоматически использует ту же базу данных, что и бот, поэтому все изменения синхронизируются между интерфейсами.
